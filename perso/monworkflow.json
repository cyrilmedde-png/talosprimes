{
  "name": "Gestion Emails Automatisée",
  "nodes": [
    {
      "name": "Déclencheur Gmail",
      "type": "n8n-nodes-base.gmailTrigger",
      "parameters": {
        "authentication": "oAuth2",
        "event": "message",
        "label": "INBOX",
        "markAsRead": true
      }
    },
    {
      "name": "Parser Email",
      "type": "n8n-nodes-base.functionItem",
      "parameters": {
        "jsCode": "const { subject, from, text } = items[0].json;\nreturn {\n  fields: {\n    sujet: subject,\n    email: from.match(/<([^>]+)>/)?.[1] || from,\n    corps: text.substring(0, 300)\n  }\n};"
      }
    },
    {
      "name": "Décision",
      "type": "n8n-nodes-base.if",
      "parameters": {
        "conditions": {
          "rules": [
            {
              "conditions": [
                {
                  "value1": "{{ $json.fields.sujet }}",
                  "value2": "devis",
                  "operation": "contains"
                }
              ]
            },
            {
              "conditions": [
                {
                  "value1": "{{ $json.fields.email }}",
                  "value2": "contact@entreprise.com",
                  "operation": "contains"
                }
              ]
            }
          ]
        }
      }
    },
    {
      "name": "Réponse Auto",
      "type": "n8n-nodes-base.gmail",
      "parameters": {
        "authentication": "oAuth2",
        "resource": "message",
        "operation": "send",
        "to": "{{ $json.fields.email }}",
        "subject": "Re: {{ $json.fields.sujet }}",
        "body": "<p>Bonjour,<br>Votre demande ({{ $json.fields.sujet }}) est traitée !</p>"
      }
    }
  ],
  "connections": {
    "Déclencheur Gmail": {
      "main": [[{"node": "Parser Email","type": "main"}]]
    },
    "Parser Email": {
      "main": [[{"node": "Décision","type": "main"}]]
    },
    "Décision": {
      "main": [
        [{"node": "Réponse Auto","type": "main","index": 0}],
        [{"node": "Réponse Auto","type": "main","index": 1}]
      ]
    }
  }
}