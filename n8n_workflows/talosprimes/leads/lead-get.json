{
  "name": "Leads - Get (lead_get) → Postgres Direct → Respond",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "lead_get",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "Webhook_LeadGet",
      "name": "Webhook - lead_get",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        300,
        300
      ]
    },
    {
      "parameters": {
        "jsCode": "// Parser le payload: { body: { data: { id } } }\nconst raw = $input.first().json;\nconst payload = (raw && typeof raw === 'object' && 'body' in raw) ? raw.body : raw;\nconst data = (payload && typeof payload === 'object' && 'data' in payload) ? payload.data : (payload ?? {});\n\nconst id = data?.id ? String(data.id).trim() : null;\n\nif (!id) {\n  throw new Error('ID du lead requis');\n}\n\nreturn [{ json: { id } }];\n"
      },
      "id": "Code_Parse",
      "name": "Parser ID",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        520,
        300
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "={{ \"SELECT id, tenant_id, nom, prenom, email, telephone, statut, source, notes, date_contact, created_at, updated_at FROM leads WHERE id = '\" + $json.id + \"'::uuid\" }}"
      },
      "id": "Postgres_Select",
      "name": "Postgres - SELECT lead",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.4,
      "position": [
        740,
        300
      ],
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "OGqj65ZoFRileCck",
          "name": "Supabase Postgres"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nif (!items || items.length === 0 || !items[0].json?.id) {\n  return [{ json: { success: false, error: 'Lead non trouvé' } }];\n}\nconst lead = items[0].json;\nreturn [{ json: { success: true, data: { lead: { id: lead.id, tenantId: lead.tenant_id, nom: lead.nom, prenom: lead.prenom, email: lead.email, telephone: lead.telephone, statut: lead.statut, source: lead.source, notes: lead.notes ?? null, dateContact: lead.date_contact ?? null, createdAt: lead.created_at, updatedAt: lead.updated_at } } } }];\n"
      },
      "id": "Code_Format",
      "name": "Formater réponse",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        960,
        300
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}"
      },
      "id": "Respond_LeadGet",
      "name": "Respond",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        1180,
        300
      ]
    }
  ],
  "connections": {
    "Webhook - lead_get": {
      "main": [
        [
          {
            "node": "Parser ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parser ID": {
      "main": [
        [
          {
            "node": "Postgres - SELECT lead",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres - SELECT lead": {
      "main": [
        [
          {
            "node": "Formater réponse",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Formater réponse": {
      "main": [
        [
          {
            "node": "Respond",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "v1"
}