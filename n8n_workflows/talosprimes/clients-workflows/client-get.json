{
  "name": "Clients - Get (client_get) → Postgres Direct → Respond",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "client_get",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "Webhook_ClientGet",
      "name": "Webhook - client_get",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        300,
        300
      ]
    },
    {
      "parameters": {
        "jsCode": "// Parser le payload: { body: { data: { id, tenantId } } }\nvar raw = $input.first().json;\nvar payload = (raw && typeof raw === 'object' && 'body' in raw) ? raw.body : raw;\nvar data = (payload && typeof payload === 'object' && 'data' in payload) ? payload.data : (payload ?? {});\n\nvar id = data?.id ? String(data.id).trim() : null;\nvar tenantId = data?.tenantId ? String(data.tenantId) : null;\n\nif (!id) throw new Error('ID du client requis');\nif (!tenantId) throw new Error('Tenant ID requis');\n\nreturn [{ json: { id, tenantId } }];\n"
      },
      "id": "Code_Parse",
      "name": "Parser ID",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        520,
        300
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "={{ \"SELECT \n  id, \n  tenant_id, \n  type, \n  raison_sociale, \n  nom, \n  prenom, \n  email, \n  telephone, \n  adresse, \n  tags, \n  statut, \n  created_at, \n  updated_at\nFROM client_finals\nWHERE id = '\" + $json.id + \"' AND tenant_id = '\" + $json.tenantId + \"';\" }}"
      },
      "id": "Postgres_Select",
      "name": "Postgres - SELECT client",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.4,
      "position": [
        740,
        300
      ],
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "OGqj65ZoFRileCck",
          "name": "Supabase Postgres"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Formater la réponse: { client: {...} }\nvar items = $input.all();\n\nif (!items || items.length === 0 || !items[0].json?.id) {\n  return [{ json: { success: false, error: 'Client non trouvé' } }];\n}\n\nvar client = items[0].json;\n\nreturn [{ \n  json: { \n    success: true, \n    data: { \n      client: {\n        id: client.id,\n        tenantId: client.tenant_id,\n        type: client.type,\n        raisonSociale: client.raison_sociale ?? null,\n        nom: client.nom ?? null,\n        prenom: client.prenom ?? null,\n        email: client.email,\n        telephone: client.telephone ?? null,\n        adresse: client.adresse ?? null,\n        tags: client.tags ?? [],\n        statut: client.statut,\n        createdAt: client.created_at,\n        updatedAt: client.updated_at\n      }\n    } \n  } \n}];\n"
      },
      "id": "Code_Format",
      "name": "Formater réponse",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        960,
        300
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}"
      },
      "id": "Respond_ClientGet",
      "name": "Respond",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        1180,
        300
      ]
    }
  ],
  "connections": {
    "Webhook - client_get": {
      "main": [
        [
          {
            "node": "Parser ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parser ID": {
      "main": [
        [
          {
            "node": "Postgres - SELECT client",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres - SELECT client": {
      "main": [
        [
          {
            "node": "Formater réponse",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Formater réponse": {
      "main": [
        [
          {
            "node": "Respond",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "v1"
}