{
  "name": "agent-knowledge-get",
  "nodes": [
    {
      "parameters": {
        "path": "agent-knowledge-get",
        "responseMode": "responseNode",
        "httpMethod": "POST"
      },
      "id": "01. Webhook",
      "name": "01. Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [100, 200]
    },
    {
      "parameters": {
        "jsCode": "var body = $input.first().json.body || $input.first().json;\n\nif (!body.tenantId) throw new Error('tenantId is required');\nif (!body.id) throw new Error('id is required');\n\nreturn [{ json: { tenantId: body.tenantId, id: body.id } }];"
      },
      "id": "02. Parser",
      "name": "02. Parser",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [300, 200]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "={{ \"SELECT id, tenant_id, categorie, titre, contenu, mots_cles, actif, ordre, created_at, updated_at FROM agent_knowledge_entries WHERE tenant_id = '\" + $('02. Parser').first().json.tenantId + \"' AND id = '\" + $('02. Parser').first().json.id + \"'\" }}"
      },
      "id": "03. Select Query",
      "name": "03. Select Query",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2,
      "credentials": {
        "postgres": { "name": "Supabase Postgres", "id": "OGqj65ZoFRileCck" }
      },
      "position": [500, 200],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "var result = $('03. Select Query').first().json;\n\nif (!result || !result.id) {\n  return [{ json: { entry: null } }];\n}\n\nreturn [{ json: { entry: {\n  id: result.id,\n  tenantId: result.tenant_id,\n  categorie: result.categorie,\n  titre: result.titre,\n  contenu: result.contenu,\n  motsCles: result.mots_cles || null,\n  actif: result.actif,\n  ordre: result.ordre || 0,\n  createdAt: result.created_at,\n  updatedAt: result.updated_at\n} } }];"
      },
      "id": "04. Format Response",
      "name": "04. Format Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [700, 200]
    },
    {
      "parameters": {
        "respondWith": "allIncomingItems"
      },
      "id": "05. Respond",
      "name": "05. Respond",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [900, 200]
    }
  ],
  "connections": {
    "01. Webhook": { "main": [[{ "node": "02. Parser", "type": "main", "index": 0 }]] },
    "02. Parser": { "main": [[{ "node": "03. Select Query", "type": "main", "index": 0 }]] },
    "03. Select Query": { "main": [[{ "node": "04. Format Response", "type": "main", "index": 0 }]] },
    "04. Format Response": { "main": [[{ "node": "05. Respond", "type": "main", "index": 0 }]] }
  },
  "active": true,
  "settings": { "executionOrder": "v1" }
}
