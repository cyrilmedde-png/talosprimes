<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TalosPrimes ‚Äî Flux Onboarding ‚Üí Espace Client</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; background: #0f172a; color: #e2e8f0; min-height: 100vh; padding: 40px 20px; }

  .container { max-width: 1200px; margin: 0 auto; }

  h1 { text-align: center; font-size: 2rem; margin-bottom: 8px; background: linear-gradient(135deg, #667eea, #a78bfa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
  .subtitle { text-align: center; color: #94a3b8; font-size: 0.95rem; margin-bottom: 50px; }

  /* Phase sections */
  .phase { margin-bottom: 60px; position: relative; }
  .phase-header { display: flex; align-items: center; gap: 16px; margin-bottom: 24px; }
  .phase-number { width: 48px; height: 48px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 1.2rem; flex-shrink: 0; }
  .phase-title { font-size: 1.3rem; font-weight: 700; }
  .phase-desc { color: #94a3b8; font-size: 0.85rem; margin-top: 2px; }

  /* Colors per phase */
  .phase-1 .phase-number { background: #1e3a5f; color: #60a5fa; border: 2px solid #3b82f6; }
  .phase-1 .phase-title { color: #60a5fa; }
  .phase-2 .phase-number { background: #1e3a2f; color: #4ade80; border: 2px solid #22c55e; }
  .phase-2 .phase-title { color: #4ade80; }
  .phase-3 .phase-number { background: #3b1f4f; color: #c084fc; border: 2px solid #a855f7; }
  .phase-3 .phase-title { color: #c084fc; }
  .phase-4 .phase-number { background: #3f2a1a; color: #fb923c; border: 2px solid #f97316; }
  .phase-4 .phase-title { color: #fb923c; }
  .phase-5 .phase-number { background: #1a3a3a; color: #2dd4bf; border: 2px solid #14b8a6; }
  .phase-5 .phase-title { color: #2dd4bf; }

  /* Flow container */
  .flow { display: flex; align-items: flex-start; gap: 0; flex-wrap: wrap; padding-left: 64px; }

  .node { background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 16px; width: 200px; position: relative; transition: all 0.2s; }
  .node:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.3); }

  .node-icon { font-size: 1.5rem; margin-bottom: 8px; }
  .node-name { font-weight: 600; font-size: 0.85rem; margin-bottom: 6px; line-height: 1.3; }
  .node-detail { color: #94a3b8; font-size: 0.75rem; line-height: 1.4; }
  .node-tech { display: inline-block; margin-top: 8px; padding: 2px 8px; border-radius: 4px; font-size: 0.65rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }

  .tech-n8n { background: #1e3a5f; color: #60a5fa; }
  .tech-stripe { background: #2d1b4e; color: #a78bfa; }
  .tech-postgres { background: #1a2e1a; color: #4ade80; }
  .tech-smtp { background: #3f2a1a; color: #fb923c; }
  .tech-twilio { background: #1a2a3a; color: #38bdf8; }
  .tech-frontend { background: #3a1a2a; color: #fb7185; }

  /* Arrow between nodes */
  .arrow { display: flex; align-items: center; justify-content: center; width: 40px; padding-top: 20px; flex-shrink: 0; }
  .arrow svg { width: 24px; height: 24px; }
  .arrow-down { display: flex; justify-content: center; width: 100%; padding: 12px 0; padding-left: 64px; }
  .arrow-down svg { width: 24px; height: 24px; }

  /* Status badges */
  .status { display: inline-flex; align-items: center; gap: 4px; padding: 3px 10px; border-radius: 20px; font-size: 0.7rem; font-weight: 600; margin-top: 6px; }
  .status-pending { background: #422006; color: #fbbf24; }
  .status-active { background: #052e16; color: #4ade80; }
  .status-waiting { background: #1e1b4b; color: #a78bfa; }

  /* Parallel branch */
  .parallel { display: flex; gap: 20px; padding-left: 64px; flex-wrap: wrap; }
  .parallel-label { padding-left: 64px; color: #94a3b8; font-size: 0.8rem; margin-bottom: 12px; font-style: italic; display: flex; align-items: center; gap: 8px; }
  .parallel-label::before { content: ''; width: 20px; height: 1px; background: #475569; }

  /* BDD state box */
  .db-state { background: #0f1729; border: 1px dashed #334155; border-radius: 12px; padding: 16px 20px; margin: 16px 0; margin-left: 64px; max-width: 800px; }
  .db-state-title { font-size: 0.8rem; font-weight: 700; color: #4ade80; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
  .db-state-title::before { content: 'üóÑÔ∏è'; }
  .db-row { display: flex; gap: 20px; flex-wrap: wrap; }
  .db-item { font-size: 0.75rem; color: #94a3b8; }
  .db-item strong { color: #e2e8f0; }

  /* Divider */
  .divider { border: none; border-top: 1px dashed #334155; margin: 40px 64px; }

  /* Trigger badge */
  .trigger-badge { position: absolute; top: -8px; right: -8px; background: #dc2626; color: white; font-size: 0.6rem; padding: 2px 8px; border-radius: 10px; font-weight: 700; }

  /* Legend */
  .legend { display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; margin-top: 50px; padding: 20px; background: #1e293b; border-radius: 12px; }
  .legend-item { display: flex; align-items: center; gap: 6px; font-size: 0.75rem; }
  .legend-dot { width: 10px; height: 10px; border-radius: 50%; }

  /* Lifecycle section */
  .lifecycle { margin-top: 60px; }
  .lifecycle h2 { text-align: center; font-size: 1.4rem; color: #e2e8f0; margin-bottom: 30px; }
  .lifecycle-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; }
  .lifecycle-card { background: #1e293b; border-radius: 12px; padding: 20px; border-left: 4px solid; transition: all 0.2s; }
  .lifecycle-card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.3); }
  .lifecycle-card h3 { font-size: 0.9rem; margin-bottom: 8px; }
  .lifecycle-card p { font-size: 0.78rem; color: #94a3b8; line-height: 1.5; }
  .lifecycle-card .event { font-size: 0.7rem; color: #64748b; margin-top: 8px; font-family: monospace; }

  .lc-checkout { border-color: #4ade80; }
  .lc-checkout h3 { color: #4ade80; }
  .lc-created { border-color: #60a5fa; }
  .lc-created h3 { color: #60a5fa; }
  .lc-updated { border-color: #fbbf24; }
  .lc-updated h3 { color: #fbbf24; }
  .lc-trial { border-color: #fb923c; }
  .lc-trial h3 { color: #fb923c; }
  .lc-deleted { border-color: #f87171; }
  .lc-deleted h3 { color: #f87171; }

  @media (max-width: 768px) {
    .flow { flex-direction: column; gap: 0; }
    .arrow { width: 100%; padding-top: 0; transform: rotate(90deg); height: 30px; }
    .node { width: 100%; }
    .parallel { flex-direction: column; }
  }
</style>
</head>
<body>
<div class="container">

<h1>üîÑ Flux Onboarding ‚Üí Espace Client</h1>
<p class="subtitle">Architecture compl√®te du parcours client ‚Äî de l'inscription au paiement confirm√©</p>

<!-- PHASE 1: D√©clenchement -->
<div class="phase phase-1">
  <div class="phase-header">
    <div class="phase-number">1</div>
    <div>
      <div class="phase-title">D√©clenchement de l'onboarding</div>
      <div class="phase-desc">Le commercial valide un lead ‚Üí l'API d√©clenche le workflow</div>
    </div>
  </div>
  <div class="flow">
    <div class="node">
      <div class="node-icon">üë§</div>
      <div class="node-name">Commercial valide le lead</div>
      <div class="node-detail">Clic sur "Convertir en client" dans le dashboard</div>
      <span class="node-tech tech-frontend">Frontend</span>
    </div>
    <div class="arrow"><svg viewBox="0 0 24 24" fill="none" stroke="#475569" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div>
    <div class="node">
      <div class="node-icon">‚ö°</div>
      <div class="node-name">API Fastify ‚Üí Webhook n8n</div>
      <div class="node-detail">POST /webhook/client-onboarding avec donn√©es client + plan choisi</div>
      <span class="node-tech tech-n8n">n8n webhook</span>
    </div>
    <div class="arrow"><svg viewBox="0 0 24 24" fill="none" stroke="#475569" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div>
    <div class="node">
      <div class="node-icon">üîß</div>
      <div class="node-name">Workflow: client-onboarding</div>
      <div class="node-detail">Orchestrateur principal ‚Äî cr√©e tout dans l'ordre</div>
      <span class="node-tech tech-n8n">n8n</span>
    </div>
  </div>
</div>

<!-- PHASE 2: Cr√©ation en BDD + Stripe -->
<div class="phase phase-2">
  <div class="phase-header">
    <div class="phase-number">2</div>
    <div>
      <div class="phase-title">Cr√©ation des ressources</div>
      <div class="phase-desc">Entr√©es BDD (en attente) + ressources Stripe</div>
    </div>
  </div>

  <div class="flow">
    <div class="node">
      <div class="node-icon">üóÑÔ∏è</div>
      <div class="node-name">INSERT client_final</div>
      <div class="node-detail">Cr√©er le client en base de donn√©es avec ses infos</div>
      <span class="node-tech tech-postgres">Postgres</span>
    </div>
    <div class="arrow"><svg viewBox="0 0 24 24" fill="none" stroke="#475569" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div>
    <div class="node">
      <div class="node-icon">üìã</div>
      <div class="node-name">INSERT subscription</div>
      <div class="node-detail">client_subscriptions avec mot de passe temporaire</div>
      <span class="status status-pending">‚è≥ en_attente</span>
      <br><span class="node-tech tech-postgres">Postgres</span>
    </div>
    <div class="arrow"><svg viewBox="0 0 24 24" fill="none" stroke="#475569" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div>
    <div class="node">
      <div class="node-icon">üè†</div>
      <div class="node-name">INSERT client_space</div>
      <div class="node-detail">Espace client cr√©√© mais pas encore accessible</div>
      <span class="status status-pending">‚è≥ en_attente</span>
      <br><span class="node-tech tech-postgres">Postgres</span>
    </div>
  </div>

  <div class="arrow-down"><svg viewBox="0 0 24 24" fill="none" stroke="#475569" stroke-width="2"><path d="M12 5v14M5 12l7 7 7-7"/></svg></div>

  <div class="flow">
    <div class="node">
      <div class="node-icon">üí≥</div>
      <div class="node-name">Cr√©er Customer Stripe</div>
      <div class="node-detail">email, name, metadata (clientId, tenantId)</div>
      <span class="node-tech tech-stripe">Stripe natif</span>
    </div>
    <div class="arrow"><svg viewBox="0 0 24 24" fill="none" stroke="#475569" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div>
    <div class="node">
      <div class="node-icon">üì¶</div>
      <div class="node-name">Cr√©er Produit Stripe</div>
      <div class="node-detail">Nom du plan + metadata</div>
      <span class="node-tech tech-stripe">Stripe natif</span>
    </div>
    <div class="arrow"><svg viewBox="0 0 24 24" fill="none" stroke="#475569" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div>
    <div class="node">
      <div class="node-icon">üí∞</div>
      <div class="node-name">Cr√©er Prix Stripe</div>
      <div class="node-detail">Montant, devise, r√©currence mensuelle</div>
      <span class="node-tech tech-stripe">Stripe natif</span>
    </div>
    <div class="arrow"><svg viewBox="0 0 24 24" fill="none" stroke="#475569" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div>
    <div class="node">
      <div class="node-icon">üîó</div>
      <div class="node-name">Cr√©er Session Checkout</div>
      <div class="node-detail">G√©n√®re l'URL de paiement Stripe</div>
      <span class="node-tech tech-stripe">httpRequest</span>
    </div>
  </div>

  <div class="db-state">
    <div class="db-state-title">√âtat BDD apr√®s Phase 2</div>
    <div class="db-row">
      <div class="db-item"><strong>clients_finaux</strong> ‚Üí ‚úÖ cr√©√©</div>
      <div class="db-item"><strong>client_subscriptions</strong> ‚Üí ‚è≥ statut: en_attente</div>
      <div class="db-item"><strong>client_spaces</strong> ‚Üí ‚è≥ statut: en_attente</div>
    </div>
  </div>
</div>

<!-- PHASE 3: Paiement -->
<div class="phase phase-3">
  <div class="phase-header">
    <div class="phase-number">3</div>
    <div>
      <div class="phase-title">Paiement par le client</div>
      <div class="phase-desc">Le client re√ßoit l'URL checkout et proc√®de au paiement</div>
    </div>
  </div>
  <div class="flow">
    <div class="node">
      <div class="node-icon">üìß</div>
      <div class="node-name">URL Checkout renvoy√©e</div>
      <div class="node-detail">Le frontend affiche le lien ou redirige le client</div>
      <span class="node-tech tech-frontend">Frontend</span>
    </div>
    <div class="arrow"><svg viewBox="0 0 24 24" fill="none" stroke="#475569" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div>
    <div class="node" style="border-color: #a855f7;">
      <div class="node-icon">üí≥</div>
      <div class="node-name">Page Stripe Checkout</div>
      <div class="node-detail">Le client entre sa carte bancaire et valide le paiement</div>
      <span class="node-tech tech-stripe">Stripe hosted</span>
    </div>
    <div class="arrow"><svg viewBox="0 0 24 24" fill="none" stroke="#475569" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div>
    <div class="node" style="border-color: #a855f7;">
      <span class="trigger-badge">TRIGGER</span>
      <div class="node-icon">üîî</div>
      <div class="node-name">checkout.session.completed</div>
      <div class="node-detail">Stripe envoie l'√©v√©nement webhook automatiquement</div>
      <span class="node-tech tech-stripe">Stripe Event</span>
    </div>
  </div>
</div>

<!-- PHASE 4: Activation -->
<div class="phase phase-4">
  <div class="phase-header">
    <div class="phase-number">4</div>
    <div>
      <div class="phase-title">Activation automatique</div>
      <div class="phase-desc">Workflow "Stripe - Checkout Completed" ‚Äî tout s'active</div>
    </div>
  </div>

  <div class="flow">
    <div class="node" style="border-color: #f97316;">
      <span class="trigger-badge">AUTO</span>
      <div class="node-icon">‚ö°</div>
      <div class="node-name">Stripe Trigger</div>
      <div class="node-detail">√âcoute checkout.session.completed</div>
      <span class="node-tech tech-stripe">stripeTrigger</span>
    </div>
    <div class="arrow"><svg viewBox="0 0 24 24" fill="none" stroke="#475569" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div>
    <div class="node">
      <div class="node-icon">üîç</div>
      <div class="node-name">Parser + Valider</div>
      <div class="node-detail">Extraire clientId, tenantId depuis les metadata Stripe</div>
      <span class="node-tech tech-n8n">Code</span>
    </div>
    <div class="arrow"><svg viewBox="0 0 24 24" fill="none" stroke="#475569" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div>
    <div class="node" style="border-color: #4ade80;">
      <div class="node-icon">‚úÖ</div>
      <div class="node-name">UPDATE subscription</div>
      <div class="node-detail">SET statut = 'actif', + IDs Stripe</div>
      <span class="status status-active">‚úÖ actif</span>
      <br><span class="node-tech tech-postgres">Postgres</span>
    </div>
    <div class="arrow"><svg viewBox="0 0 24 24" fill="none" stroke="#475569" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div>
    <div class="node" style="border-color: #4ade80;">
      <div class="node-icon">üè†</div>
      <div class="node-name">UPDATE espace client</div>
      <div class="node-detail">SET statut = 'actif' ‚Üí espace d√©verrouill√© !</div>
      <span class="status status-active">‚úÖ actif</span>
      <br><span class="node-tech tech-postgres">Postgres</span>
    </div>
  </div>

  <div class="arrow-down"><svg viewBox="0 0 24 24" fill="none" stroke="#475569" stroke-width="2"><path d="M12 5v14M5 12l7 7 7-7"/></svg></div>

  <div class="parallel-label">Actions parall√®les apr√®s activation</div>
  <div class="parallel">
    <div class="node">
      <div class="node-icon">üìß</div>
      <div class="node-name">Email identifiants</div>
      <div class="node-detail">Email + mot de passe temporaire + lien login talosprimes.com</div>
      <span class="node-tech tech-smtp">SMTP</span>
    </div>
    <div class="node">
      <div class="node-icon">üîî</div>
      <div class="node-name">Notification admin</div>
      <div class="node-detail">INSERT notifications ‚Üí "Paiement confirm√©, espace actif"</div>
      <span class="node-tech tech-postgres">Postgres</span>
    </div>
  </div>

  <div class="db-state">
    <div class="db-state-title">√âtat BDD apr√®s Phase 4</div>
    <div class="db-row">
      <div class="db-item"><strong>clients_finaux</strong> ‚Üí ‚úÖ cr√©√©</div>
      <div class="db-item"><strong>client_subscriptions</strong> ‚Üí ‚úÖ statut: <span style="color:#4ade80;font-weight:700;">actif</span></div>
      <div class="db-item"><strong>client_spaces</strong> ‚Üí ‚úÖ statut: <span style="color:#4ade80;font-weight:700;">actif</span></div>
    </div>
  </div>
</div>

<!-- PHASE 5: Premi√®re connexion -->
<div class="phase phase-5">
  <div class="phase-header">
    <div class="phase-number">5</div>
    <div>
      <div class="phase-title">Premi√®re connexion du client</div>
      <div class="phase-desc">Le client acc√®de √† son espace et change son mot de passe</div>
    </div>
  </div>
  <div class="flow">
    <div class="node">
      <div class="node-icon">üì¨</div>
      <div class="node-name">Client re√ßoit l'email</div>
      <div class="node-detail">Contient email + mot de passe temporaire + bouton de connexion</div>
      <span class="node-tech tech-smtp">Email</span>
    </div>
    <div class="arrow"><svg viewBox="0 0 24 24" fill="none" stroke="#475569" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div>
    <div class="node">
      <div class="node-icon">üîê</div>
      <div class="node-name">Login talosprimes.com</div>
      <div class="node-detail">Saisit ses identifiants temporaires</div>
      <span class="node-tech tech-frontend">Frontend</span>
    </div>
    <div class="arrow"><svg viewBox="0 0 24 24" fill="none" stroke="#475569" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div>
    <div class="node" style="border-color: #2dd4bf;">
      <div class="node-icon">üîë</div>
      <div class="node-name">Changement mot de passe</div>
      <div class="node-detail">Obligatoire √† la premi√®re connexion</div>
      <span class="node-tech tech-frontend">Frontend</span>
    </div>
    <div class="arrow"><svg viewBox="0 0 24 24" fill="none" stroke="#475569" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div>
    <div class="node" style="border-color: #2dd4bf;">
      <div class="node-icon">üéâ</div>
      <div class="node-name">Espace client actif !</div>
      <div class="node-detail">Acc√®s complet √† toutes les fonctionnalit√©s du plan</div>
      <span class="status status-active">‚úÖ Op√©rationnel</span>
    </div>
  </div>
</div>

<hr class="divider">

<!-- Lifecycle -->
<div class="lifecycle">
  <h2>üîÑ Cycle de vie de l'abonnement ‚Äî Sub-workflows Stripe</h2>
  <p style="text-align:center; color:#94a3b8; font-size:0.85rem; margin-bottom:24px;">Ces 5 workflows √©coutent les √©v√©nements Stripe en continu apr√®s l'onboarding</p>

  <div class="lifecycle-grid">
    <div class="lifecycle-card lc-checkout">
      <h3>‚úÖ Checkout Completed</h3>
      <p>Active l'abonnement et l'espace client. Envoie les identifiants par email. Notifie l'admin.</p>
      <div class="event">checkout.session.completed</div>
    </div>
    <div class="lifecycle-card lc-created">
      <h3>üìù Subscription Created</h3>
      <p>Synchronise les IDs Stripe (subscription, customer) en BDD. Enregistre les dates de d√©but/fin.</p>
      <div class="event">customer.subscription.created</div>
    </div>
    <div class="lifecycle-card lc-updated">
      <h3>üîÑ Subscription Updated</h3>
      <p>G√®re les changements de plan (upgrade/downgrade) et les statuts. Suspend l'espace si impay√© (past_due).</p>
      <div class="event">customer.subscription.updated</div>
    </div>
    <div class="lifecycle-card lc-trial">
      <h3>‚è∞ Trial Ending</h3>
      <p>Notifie le client par email + SMS avant l'expiration de sa p√©riode d'essai. Alerte l'admin.</p>
      <div class="event">customer.subscription.trial_will_end</div>
    </div>
    <div class="lifecycle-card lc-deleted">
      <h3>‚ùå Subscription Deleted</h3>
      <p>D√©sactive l'espace client. Notifie par email + SMS. Conservation des donn√©es 30 jours.</p>
      <div class="event">customer.subscription.deleted</div>
    </div>
  </div>
</div>

<!-- Legend -->
<div class="legend">
  <div class="legend-item"><div class="legend-dot" style="background:#60a5fa;"></div> n8n Workflow</div>
  <div class="legend-item"><div class="legend-dot" style="background:#a78bfa;"></div> Stripe</div>
  <div class="legend-item"><div class="legend-dot" style="background:#4ade80;"></div> Postgres / BDD</div>
  <div class="legend-item"><div class="legend-dot" style="background:#fb923c;"></div> Email SMTP</div>
  <div class="legend-item"><div class="legend-dot" style="background:#38bdf8;"></div> Twilio SMS</div>
  <div class="legend-item"><div class="legend-dot" style="background:#fb7185;"></div> Frontend</div>
  <div class="legend-item"><div class="legend-dot" style="background:#fbbf24;"></div> ‚è≥ En attente</div>
  <div class="legend-item"><div class="legend-dot" style="background:#4ade80;"></div> ‚úÖ Actif</div>
</div>

<p style="text-align:center; color:#475569; font-size:0.75rem; margin-top:30px;">TalosPrimes ‚Äî Architecture Onboarding & Abonnements ‚Äî F√©vrier 2026</p>

</div>
</body>
</html>
