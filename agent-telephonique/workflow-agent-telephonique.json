{
  "name": "ü§ñ Agent T√©l√©phonique IA ‚Äî Multi-Niche",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "twilio-voice-incoming",
        "responseMode": "responseNode",
        "options": {
          "rawBody": true
        }
      },
      "id": "webhook-incoming-call",
      "name": "üìû Appel Entrant (Twilio)",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [220, 300],
      "webhookId": "twilio-voice-incoming"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "caller-phone",
              "name": "caller_phone",
              "value": "={{ $json.body.From || $json.body.Caller || 'inconnu' }}",
              "type": "string"
            },
            {
              "id": "call-sid",
              "name": "call_sid",
              "value": "={{ $json.body.CallSid || '' }}",
              "type": "string"
            },
            {
              "id": "call-status",
              "name": "call_status",
              "value": "={{ $json.body.CallStatus || 'ringing' }}",
              "type": "string"
            },
            {
              "id": "called-number",
              "name": "called_number",
              "value": "={{ $json.body.Called || $json.body.To || '' }}",
              "type": "string"
            },
            {
              "id": "from-city",
              "name": "from_city",
              "value": "={{ $json.body.FromCity || $json.body.CallerCity || '' }}",
              "type": "string"
            },
            {
              "id": "conversation-id",
              "name": "conversation_id",
              "value": "={{ $json.body.CallSid || '' }}",
              "type": "string"
            }
          ]
        }
      },
      "id": "set-call-context",
      "name": "üìã Extraire Contexte Appel",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [440, 300]
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ '<?xml version=\"1.0\" encoding=\"UTF-8\"?><Response><Say language=\"fr-FR\" voice=\"Google.fr-FR-Wavenet-A\">' + $json.greeting_message + '</Say><Gather input=\"speech\" language=\"fr-FR\" speechTimeout=\"3\" timeout=\"10\" action=\"' + $json.conversation_webhook_url + '\" method=\"POST\"><Say language=\"fr-FR\" voice=\"Google.fr-FR-Wavenet-A\">Je vous √©coute.</Say></Gather><Say language=\"fr-FR\" voice=\"Google.fr-FR-Wavenet-A\">Je n\\'ai pas entendu de r√©ponse. N\\'h√©sitez pas √† nous rappeler. Au revoir !</Say></Response>' }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/xml"
              }
            ]
          }
        }
      },
      "id": "respond-greeting",
      "name": "üó£Ô∏è R√©pondre Accueil (TwiML)",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [1100, 300]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "greeting-msg",
              "name": "greeting_message",
              "value": "Bonjour ! Bienvenue chez notre service. Ici Sophie, votre assistante. Comment puis-je vous aider aujourd'hui ?",
              "type": "string"
            },
            {
              "id": "conv-webhook",
              "name": "conversation_webhook_url",
              "value": "https://n8n.talosprimes.com/webhook/twilio-voice-conversation",
              "type": "string"
            }
          ]
        }
      },
      "id": "set-greeting",
      "name": "üí¨ Pr√©parer Accueil",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [880, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.talosprimes.com/api/leads",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ source: 'phone', phone: $json.caller_phone, city: $json.from_city, notes: 'Appel entrant - CallSid: ' + $json.call_sid, status: 'nouveau' }) }}"
      },
      "id": "create-lead-on-call",
      "name": "üìù Cr√©er Lead (Appel)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [660, 500],
      "credentials": {
        "httpHeaderAuth": {
          "id": "HEADER_AUTH_CREDENTIAL_ID",
          "name": "TalosPrimes API"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "twilio-voice-conversation",
        "responseMode": "responseNode",
        "options": {
          "rawBody": true
        }
      },
      "id": "webhook-conversation",
      "name": "üîÑ Tour de Conversation (Twilio)",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [220, 800],
      "webhookId": "twilio-voice-conversation"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "speech-result",
              "name": "user_speech",
              "value": "={{ $json.body.SpeechResult || '' }}",
              "type": "string"
            },
            {
              "id": "confidence",
              "name": "confidence",
              "value": "={{ $json.body.Confidence || '0' }}",
              "type": "string"
            },
            {
              "id": "call-sid-conv",
              "name": "call_sid",
              "value": "={{ $json.body.CallSid || '' }}",
              "type": "string"
            },
            {
              "id": "caller-phone-conv",
              "name": "caller_phone",
              "value": "={{ $json.body.From || $json.body.Caller || 'inconnu' }}",
              "type": "string"
            }
          ]
        }
      },
      "id": "extract-speech",
      "name": "üé§ Extraire Parole",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [440, 800]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false
          },
          "conditions": [
            {
              "id": "check-speech-empty",
              "leftValue": "={{ $json.user_speech }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty"
              }
            }
          ]
        }
      },
      "id": "check-speech",
      "name": "‚ùì Parole D√©tect√©e ?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [660, 800]
    },
    {
      "parameters": {
        "url": "https://api.anthropic.com/v1/messages",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "anthropicApi",
        "method": "POST",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "anthropic-version",
              "value": "2023-06-01"
            },
            {
              "name": "content-type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ model: 'claude-sonnet-4-5-20250929', max_tokens: 300, system: $('üìö Charger Prompt Syst√®me').item.json.system_prompt, messages: [{ role: 'user', content: 'APPEL EN COURS - Num√©ro: ' + $json.caller_phone + '\\n\\nL\\'interlocuteur dit: \"' + $json.user_speech + '\"\\n\\nR√©ponds de mani√®re naturelle, concise (2-3 phrases max), chaleureuse. Tu es au t√©l√©phone, pas par √©crit. Pas de markdown, pas de listes, pas d\\'√©mojis. √âcris les chiffres en toutes lettres. Si tu as besoin d\\'informations, pose UNE seule question.' }] }) }}"
      },
      "id": "claude-response",
      "name": "üß† Claude (R√©ponse IA)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1100, 750],
      "credentials": {
        "anthropicApi": {
          "id": "ANTHROPIC_CREDENTIAL_ID",
          "name": "Anthropic"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ai-response",
              "name": "ai_response",
              "value": "={{ $json.content[0].text || 'Je suis d√©sol√©e, pourriez-vous r√©p√©ter s\\'il vous pla√Æt ?' }}",
              "type": "string"
            },
            {
              "id": "call-sid-for-twiml",
              "name": "call_sid",
              "value": "={{ $('üé§ Extraire Parole').item.json.call_sid }}",
              "type": "string"
            },
            {
              "id": "caller-phone-for-twiml",
              "name": "caller_phone",
              "value": "={{ $('üé§ Extraire Parole').item.json.caller_phone }}",
              "type": "string"
            },
            {
              "id": "user-said",
              "name": "user_said",
              "value": "={{ $('üé§ Extraire Parole').item.json.user_speech }}",
              "type": "string"
            }
          ]
        }
      },
      "id": "format-ai-response",
      "name": "‚úÇÔ∏è Formater R√©ponse IA",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [1320, 750]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false
          },
          "conditions": [
            {
              "id": "check-goodbye",
              "leftValue": "={{ $json.ai_response.toLowerCase() }}",
              "rightValue": "={{ /(au revoir|bonne journ√©e|bonne soir√©e|merci.*revoir|√† bient√¥t)/.test($json.ai_response.toLowerCase()) }}",
              "operator": {
                "type": "boolean",
                "operation": "true"
              }
            }
          ]
        }
      },
      "id": "check-end-call",
      "name": "üèÅ Fin de Conversation ?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1540, 750]
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ '<?xml version=\"1.0\" encoding=\"UTF-8\"?><Response><Say language=\"fr-FR\" voice=\"Google.fr-FR-Wavenet-A\">' + $json.ai_response.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;').replace(/'/g, '&apos;') + '</Say><Gather input=\"speech\" language=\"fr-FR\" speechTimeout=\"3\" timeout=\"10\" action=\"https://n8n.talosprimes.com/webhook/twilio-voice-conversation\" method=\"POST\"><Say language=\"fr-FR\" voice=\"Google.fr-FR-Wavenet-A\">...</Say></Gather><Say language=\"fr-FR\" voice=\"Google.fr-FR-Wavenet-A\">√ätes-vous toujours en ligne ?</Say><Gather input=\"speech\" language=\"fr-FR\" speechTimeout=\"3\" timeout=\"5\" action=\"https://n8n.talosprimes.com/webhook/twilio-voice-conversation\" method=\"POST\"><Say language=\"fr-FR\" voice=\"Google.fr-FR-Wavenet-A\">Je ne vous entends plus, je vais devoir raccrocher. N\\'h√©sitez pas √† nous rappeler. Au revoir !</Say></Gather></Response>' }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/xml"
              }
            ]
          }
        }
      },
      "id": "respond-continue",
      "name": "üîÑ Continuer Conversation (TwiML)",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [1760, 650]
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ '<?xml version=\"1.0\" encoding=\"UTF-8\"?><Response><Say language=\"fr-FR\" voice=\"Google.fr-FR-Wavenet-A\">' + $json.ai_response.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;').replace(/'/g, '&apos;') + '</Say><Hangup/></Response>' }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/xml"
              }
            ]
          }
        }
      },
      "id": "respond-goodbye",
      "name": "üëã Cl√¥turer Appel (TwiML)",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [1760, 880]
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ '<?xml version=\"1.0\" encoding=\"UTF-8\"?><Response><Say language=\"fr-FR\" voice=\"Google.fr-FR-Wavenet-A\">Excusez-moi, je n\\'ai pas bien compris. Pourriez-vous r√©p√©ter s\\'il vous pla√Æt ?</Say><Gather input=\"speech\" language=\"fr-FR\" speechTimeout=\"4\" timeout=\"10\" action=\"https://n8n.talosprimes.com/webhook/twilio-voice-conversation\" method=\"POST\"><Say language=\"fr-FR\" voice=\"Google.fr-FR-Wavenet-A\">Je vous √©coute.</Say></Gather><Say language=\"fr-FR\" voice=\"Google.fr-FR-Wavenet-A\">Je ne vous entends pas. Vous pouvez nous rappeler ou envoyer un SMS. Au revoir et bonne journ√©e !</Say></Response>' }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/xml"
              }
            ]
          }
        }
      },
      "id": "respond-no-speech",
      "name": "üîá Pas de Parole (TwiML)",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [880, 950]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "system-prompt",
              "name": "system_prompt",
              "value": "Tu es Sophie, l'assistante t√©l√©phonique de notre entreprise. Tu r√©ponds aux appels entrants avec professionnalisme et chaleur. R√àGLES ABSOLUES: 1) Tu ne r√©v√®les JAMAIS que tu es une IA. 2) Toujours en fran√ßais. 3) R√©ponses de 2-3 phrases MAX (c'est un appel t√©l√©phonique). 4) Tu vouvoies par d√©faut. 5) Tu √©cris les chiffres en toutes lettres. 6) Pas de markdown, pas de listes, pas d'√©mojis. 7) Tu es chaleureuse, empathique, rassurante. 8) Tu poses UNE seule question √† la fois. 9) Si tu ne sais pas, dis que tu fais remonter √† l'√©quipe. PROCESSUS: Accueil > Qualification (nom, besoin, urgence, adresse) > Action (RDV, dispatch, devis, info) > Cl√¥ture avec r√©sum√©. GESTION DES √âMOTIONS: Col√®re = valider + agir. D√©tresse = ralentir + empathie. Panique = prendre le contr√¥le. IMPORTANT: √Ä la fin de la conversation, termine toujours par une formule d'au revoir chaleureuse.",
              "type": "string"
            }
          ]
        }
      },
      "id": "load-system-prompt",
      "name": "üìö Charger Prompt Syst√®me",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [880, 750]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "twilio-call-status",
        "responseMode": "lastNode",
        "options": {}
      },
      "id": "webhook-call-status",
      "name": "üìä Status Appel (Twilio)",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [220, 1300],
      "webhookId": "twilio-call-status"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false
          },
          "conditions": [
            {
              "id": "check-completed",
              "leftValue": "={{ $json.body.CallStatus }}",
              "rightValue": "completed",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ]
        }
      },
      "id": "check-call-completed",
      "name": "‚úÖ Appel Termin√© ?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [440, 1300]
    },
    {
      "parameters": {
        "url": "https://api.anthropic.com/v1/messages",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "anthropicApi",
        "method": "POST",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "anthropic-version",
              "value": "2023-06-01"
            },
            {
              "name": "content-type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ model: 'claude-sonnet-4-5-20250929', max_tokens: 500, system: 'Tu g√©n√®res un r√©sum√© SMS professionnel et concis d\\'un appel t√©l√©phonique. Le SMS doit contenir: le nom si connu, le r√©sum√© du besoin, l\\'action prise (RDV, dispatch, devis, info), et un message de remerciement. Maximum 160 caract√®res par SMS. √âcris en fran√ßais.', messages: [{ role: 'user', content: 'G√©n√®re un SMS de suivi pour cet appel.\\nNum√©ro appelant: ' + ($json.body.From || 'inconnu') + '\\nDur√©e: ' + ($json.body.CallDuration || '0') + ' secondes\\nStatut: termin√©\\n\\nG√©n√®re UNIQUEMENT le texte du SMS, rien d\\'autre.' }] }) }}"
      },
      "id": "generate-sms-summary",
      "name": "üìù G√©n√©rer SMS R√©sum√©",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [660, 1200],
      "credentials": {
        "anthropicApi": {
          "id": "ANTHROPIC_CREDENTIAL_ID",
          "name": "Anthropic"
        }
      }
    },
    {
      "parameters": {
        "url": "https://api.twilio.com/2010-04-01/Accounts/{{TWILIO_ACCOUNT_SID}}/Messages.json",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "twilioApi",
        "method": "POST",
        "sendBody": true,
        "contentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            {
              "name": "To",
              "value": "={{ $('üìä Status Appel (Twilio)').item.json.body.From }}"
            },
            {
              "name": "From",
              "value": "={{TWILIO_PHONE_NUMBER}}"
            },
            {
              "name": "Body",
              "value": "={{ $json.content[0].text }}"
            }
          ]
        }
      },
      "id": "send-sms-followup",
      "name": "üì± Envoyer SMS Suivi",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [880, 1200],
      "credentials": {
        "twilioApi": {
          "id": "TWILIO_CREDENTIAL_ID",
          "name": "Twilio"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.talosprimes.com/api/notifications",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ type: 'phone_call_completed', channel: 'sms', data: { caller: $('üìä Status Appel (Twilio)').item.json.body.From || 'inconnu', duration: $('üìä Status Appel (Twilio)').item.json.body.CallDuration || '0', call_sid: $('üìä Status Appel (Twilio)').item.json.body.CallSid || '', status: 'completed' } }) }}"
      },
      "id": "notify-owner",
      "name": "üîî Notifier Propri√©taire",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [880, 1400],
      "credentials": {
        "httpHeaderAuth": {
          "id": "HEADER_AUTH_CREDENTIAL_ID",
          "name": "TalosPrimes API"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.telegram.org/bot{{TELEGRAM_BOT_TOKEN}}/sendMessage",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ chat_id: '{{TELEGRAM_CHAT_ID}}', text: 'üìû APPEL TERMIN√â\\n\\nüì± Num√©ro: ' + ($('üìä Status Appel (Twilio)').item.json.body.From || 'inconnu') + '\\n‚è±Ô∏è Dur√©e: ' + ($('üìä Status Appel (Twilio)').item.json.body.CallDuration || '0') + 's\\nüìä Statut: ' + ($('üìä Status Appel (Twilio)').item.json.body.CallStatus || 'inconnu') + '\\n\\n‚úÖ SMS de suivi envoy√©', parse_mode: 'HTML' }) }}"
      },
      "id": "telegram-notify",
      "name": "üì® Notification Telegram",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1100, 1300]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO call_logs (call_sid, caller_phone, called_number, duration, status, created_at) VALUES ('{{ $('üìä Status Appel (Twilio)').item.json.body.CallSid }}', '{{ $('üìä Status Appel (Twilio)').item.json.body.From }}', '{{ $('üìä Status Appel (Twilio)').item.json.body.To }}', {{ parseInt($('üìä Status Appel (Twilio)').item.json.body.CallDuration) || 0 }}, '{{ $('üìä Status Appel (Twilio)').item.json.body.CallStatus }}', NOW())",
        "options": {}
      },
      "id": "log-to-database",
      "name": "üíæ Logger en BDD",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [660, 1400],
      "credentials": {
        "postgres": {
          "id": "POSTGRES_CREDENTIAL_ID",
          "name": "PostgreSQL"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "twilio-voice-outbound",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-outbound-trigger",
      "name": "üì§ D√©clencher Appel Sortant",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [220, 1700],
      "webhookId": "twilio-voice-outbound"
    },
    {
      "parameters": {
        "url": "https://api.twilio.com/2010-04-01/Accounts/{{TWILIO_ACCOUNT_SID}}/Calls.json",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "twilioApi",
        "method": "POST",
        "sendBody": true,
        "contentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            {
              "name": "To",
              "value": "={{ $json.body.to || $json.query.to }}"
            },
            {
              "name": "From",
              "value": "={{TWILIO_PHONE_NUMBER}}"
            },
            {
              "name": "Url",
              "value": "https://n8n.talosprimes.com/webhook/twilio-voice-outbound-twiml"
            },
            {
              "name": "StatusCallback",
              "value": "https://n8n.talosprimes.com/webhook/twilio-call-status"
            },
            {
              "name": "StatusCallbackMethod",
              "value": "POST"
            },
            {
              "name": "StatusCallbackEvent",
              "value": "completed"
            }
          ]
        }
      },
      "id": "initiate-outbound-call",
      "name": "üìû Lancer Appel Sortant",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [440, 1700],
      "credentials": {
        "twilioApi": {
          "id": "TWILIO_CREDENTIAL_ID",
          "name": "Twilio"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ JSON.stringify({ success: true, message: 'Appel sortant initi√©', call_sid: $json.sid }) }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          }
        }
      },
      "id": "respond-outbound-status",
      "name": "‚úÖ Confirmer Appel Lanc√©",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [660, 1700]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "twilio-voice-outbound-twiml",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-outbound-twiml",
      "name": "üì§ TwiML Appel Sortant",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [220, 2000],
      "webhookId": "twilio-voice-outbound-twiml"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ '<?xml version=\"1.0\" encoding=\"UTF-8\"?><Response><Say language=\"fr-FR\" voice=\"Google.fr-FR-Wavenet-A\">Bonjour, ici Sophie de notre service. Nous revenons vers vous suite √† votre demande. Avez-vous un moment pour en discuter ?</Say><Gather input=\"speech\" language=\"fr-FR\" speechTimeout=\"3\" timeout=\"10\" action=\"https://n8n.talosprimes.com/webhook/twilio-voice-conversation\" method=\"POST\"><Say language=\"fr-FR\" voice=\"Google.fr-FR-Wavenet-A\">Je vous √©coute.</Say></Gather><Say language=\"fr-FR\" voice=\"Google.fr-FR-Wavenet-A\">Je ne vous entends pas. Nous vous rappellerons ult√©rieurement. Bonne journ√©e !</Say></Response>' }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/xml"
              }
            ]
          }
        }
      },
      "id": "respond-outbound-greeting",
      "name": "üó£Ô∏è Accueil Appel Sortant",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [440, 2000]
    }
  ],
  "connections": {
    "üìû Appel Entrant (Twilio)": {
      "main": [
        [
          {
            "node": "üìã Extraire Contexte Appel",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üìã Extraire Contexte Appel": {
      "main": [
        [
          {
            "node": "üí¨ Pr√©parer Accueil",
            "type": "main",
            "index": 0
          },
          {
            "node": "üìù Cr√©er Lead (Appel)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üí¨ Pr√©parer Accueil": {
      "main": [
        [
          {
            "node": "üó£Ô∏è R√©pondre Accueil (TwiML)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üîÑ Tour de Conversation (Twilio)": {
      "main": [
        [
          {
            "node": "üé§ Extraire Parole",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üé§ Extraire Parole": {
      "main": [
        [
          {
            "node": "‚ùì Parole D√©tect√©e ?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "‚ùì Parole D√©tect√©e ?": {
      "main": [
        [
          {
            "node": "üìö Charger Prompt Syst√®me",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "üîá Pas de Parole (TwiML)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üìö Charger Prompt Syst√®me": {
      "main": [
        [
          {
            "node": "üß† Claude (R√©ponse IA)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üß† Claude (R√©ponse IA)": {
      "main": [
        [
          {
            "node": "‚úÇÔ∏è Formater R√©ponse IA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "‚úÇÔ∏è Formater R√©ponse IA": {
      "main": [
        [
          {
            "node": "üèÅ Fin de Conversation ?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üèÅ Fin de Conversation ?": {
      "main": [
        [
          {
            "node": "üëã Cl√¥turer Appel (TwiML)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "üîÑ Continuer Conversation (TwiML)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üìä Status Appel (Twilio)": {
      "main": [
        [
          {
            "node": "‚úÖ Appel Termin√© ?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "‚úÖ Appel Termin√© ?": {
      "main": [
        [
          {
            "node": "üìù G√©n√©rer SMS R√©sum√©",
            "type": "main",
            "index": 0
          },
          {
            "node": "üíæ Logger en BDD",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "üìù G√©n√©rer SMS R√©sum√©": {
      "main": [
        [
          {
            "node": "üì± Envoyer SMS Suivi",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üì± Envoyer SMS Suivi": {
      "main": [
        [
          {
            "node": "üì® Notification Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üíæ Logger en BDD": {
      "main": [
        [
          {
            "node": "üîî Notifier Propri√©taire",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üì§ D√©clencher Appel Sortant": {
      "main": [
        [
          {
            "node": "üìû Lancer Appel Sortant",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üìû Lancer Appel Sortant": {
      "main": [
        [
          {
            "node": "‚úÖ Confirmer Appel Lanc√©",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üì§ TwiML Appel Sortant": {
      "main": [
        [
          {
            "node": "üó£Ô∏è Accueil Appel Sortant",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "name": "agent-telephonique"
    },
    {
      "name": "twilio"
    },
    {
      "name": "vocal"
    }
  ]
}
